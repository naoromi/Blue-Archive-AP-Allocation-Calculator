<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schale AP Manager</title>
    <!-- Tailwind CSS (via CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM (via CDN) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel (to compile JSX in browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* Custom scrollbar to match theme */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons (Inline SVGs to remove dependencies) ---
        const IconWrapper = ({ children, size = 24, className = "" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const Zap = (props) => <IconWrapper {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></IconWrapper>;
        const Ticket = (props) => <IconWrapper {...props}><path d="M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/><path d="M13 5v2"/><path d="M13 17v2"/><path d="M13 11v2"/></IconWrapper>;
        const Calendar = (props) => <IconWrapper {...props}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></IconWrapper>;
        const Target = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></IconWrapper>;
        const CheckCircle = (props) => <IconWrapper {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconWrapper>;
        const AlertTriangle = (props) => <IconWrapper {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></IconWrapper>;
        const Info = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="16" y2="12"/><line x1="12" x2="12.01" y1="8" y2="8"/></IconWrapper>;
        const CalculatorIcon = (props) => <IconWrapper {...props}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></IconWrapper>;

        // --- Main Component ---
        const BlueArchiveCalculator = () => {
            // Numeric values used for calculation
            const [inputs, setInputs] = useState({
                totalDailyAP: 0,
                ticketsPerAP: 0,
                targetTickets: 0,
                eventDuration: 0
            });

            // String values for input fields (allows typing expressions)
            const [displayInputs, setDisplayInputs] = useState({
                totalDailyAP: "",
                ticketsPerAP: "",
                targetTickets: "",
                eventDuration: ""
            });

            const [results, setResults] = useState({
                totalAPRequired: 0,
                dailyEventAP: 0,
                dailySpareAP: 0,
                isPossible: true,
                percentageUsed: 0
            });

            useEffect(() => {
                const { totalDailyAP, ticketsPerAP, targetTickets, eventDuration } = inputs;
                
                // If critical inputs are missing/zero, reset results or show neutral state
                if (ticketsPerAP <= 0 || eventDuration <= 0) {
                    setResults({
                        totalAPRequired: 0,
                        dailyEventAP: 0,
                        dailySpareAP: 0,
                        isPossible: true,
                        percentageUsed: 0
                    });
                    return;
                }

                const totalAPRequired = targetTickets / ticketsPerAP;
                const dailyEventAP = totalAPRequired / eventDuration;
                const dailySpareAP = totalDailyAP - dailyEventAP;
                const isPossible = dailySpareAP >= 0;
                const percentageUsed = totalDailyAP > 0 ? (dailyEventAP / totalDailyAP) * 100 : 0;

                setResults({
                    totalAPRequired,
                    dailyEventAP,
                    dailySpareAP,
                    isPossible,
                    percentageUsed: Math.min(percentageUsed, 100)
                });
            }, [inputs]);

            // Helper to evaluate math expressions safely
            const evaluateExpression = (expression) => {
                if (!expression) return 0;
                try {
                    // Remove whitespace AND commas
                    const sanitized = String(expression).replace(/[\s,]/g, '');
                    // Only allow digits and math operators
                    if (/^[0-9+\-*/().]+$/.test(sanitized)) {
                        const result = new Function('return ' + sanitized)();
                        return isFinite(result) ? result : 0;
                    }
                    return parseFloat(sanitized);
                } catch (e) {
                    return parseFloat(String(expression).replace(/,/g, '')) || 0;
                }
            };

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                // Update the UI text immediately
                setDisplayInputs(prev => ({
                    ...prev,
                    [name]: value
                }));
            };

            const handleInputBlur = (e) => {
                const { name, value } = e.target;
                
                // If empty or whitespace only, reset to empty string without defaulting to 0
                if (!value.trim()) {
                    setInputs(prev => ({ ...prev, [name]: 0 }));
                    setDisplayInputs(prev => ({ ...prev, [name]: "" }));
                    return;
                }

                const evaluated = evaluateExpression(value);
                
                if (!isNaN(evaluated)) {
                    // Update the calculation state
                    setInputs(prev => ({
                        ...prev,
                        [name]: evaluated
                    }));
                    // Update the display to show the result
                    setDisplayInputs(prev => ({
                        ...prev,
                        [name]: evaluated.toString()
                    }));
                }
            };

            const handleKeyDown = (e) => {
                if (e.key === 'Enter') {
                    e.target.blur();
                }
            };

            const formatNum = (num) => {
                return new Intl.NumberFormat('en-US', { 
                    maximumFractionDigits: 2,
                    minimumFractionDigits: 0 
                }).format(num);
            };

            return (
                <div className="min-h-screen font-sans selection:bg-cyan-200 relative overflow-x-hidden">
                    {/* Background Decoration */}
                    <div className="fixed inset-0 z-0 opacity-5 pointer-events-none overflow-hidden">
                        <div className="absolute top-0 right-0 w-[500px] h-[500px] bg-blue-400 rounded-full blur-[100px] -translate-y-1/2 translate-x-1/2"></div>
                        <div className="absolute bottom-0 left-0 w-[400px] h-[400px] bg-cyan-400 rounded-full blur-[80px] translate-y-1/2 -translate-x-1/2"></div>
                        <div className="w-full h-full" style={{ backgroundImage: 'radial-gradient(#3b82f6 1px, transparent 1px)', backgroundSize: '40px 40px' }}></div>
                    </div>

                    <div className="relative z-10 max-w-5xl mx-auto p-4 md:p-8">
                        {/* Header */}
                        <header className="mb-8 flex items-center justify-between bg-white/80 backdrop-blur-md p-4 rounded-xl shadow-sm border-l-4 border-blue-500">
                            <div className="flex items-center gap-3">
                                <div className="bg-blue-500 p-2 rounded-lg text-white shadow-lg shadow-blue-500/30">
                                    <CalculatorIcon size={24} />
                                </div>
                                <div>
                                    <h1 className="text-xl font-bold text-slate-800 tracking-tight">SCHALE <span className="text-blue-500 font-extrabold">AP MANAGER</span></h1>
                                    <p className="text-xs text-slate-500 font-medium uppercase tracking-widest">Event Resource Logistics</p>
                                </div>
                            </div>
                            <div className="hidden md:flex items-center gap-2 text-sm font-bold text-slate-400">
                                <span>SENSEI ID: 0001284</span>
                                <div className="w-2 h-2 rounded-full bg-green-400 animate-pulse"></div>
                            </div>
                        </header>

                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
                            {/* Inputs */}
                            <div className="lg:col-span-5 space-y-6">
                                <div className="bg-white rounded-2xl shadow-sm p-6 border border-slate-100 relative overflow-hidden">
                                    <div className="absolute top-0 right-0 p-4 opacity-10">
                                        <Target size={120} className="text-blue-500" />
                                    </div>
                                    <h2 className="text-lg font-bold flex items-center gap-2 mb-6 text-slate-700">
                                        <span className="w-1 h-6 bg-blue-500 rounded-full"></span>
                                        Mission Parameters
                                    </h2>

                                    <div className="space-y-5">
                                        <div className="group">
                                            <label className="text-xs font-bold text-slate-500 uppercase tracking-wider mb-1.5 flex justify-between">
                                                <span>Total AP / Day</span>
                                                <span className="text-blue-400 group-hover:text-blue-600 transition-colors">Daily Income</span>
                                            </label>
                                            <div className="relative">
                                                <div className="absolute left-3 top-1/2 -translate-y-1/2 text-amber-500"><Zap size={20} /></div>
                                                <input 
                                                    type="text" 
                                                    inputMode="decimal"
                                                    name="totalDailyAP" 
                                                    value={displayInputs.totalDailyAP} 
                                                    onChange={handleInputChange} 
                                                    onBlur={handleInputBlur}
                                                    onKeyDown={handleKeyDown}
                                                    placeholder="e.g. 360+50"
                                                    className="w-full pl-10 pr-4 py-3 bg-slate-50 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-500/10 transition-all font-mono font-bold text-lg text-slate-700" 
                                                />
                                            </div>
                                        </div>
                                        <div className="group">
                                            <label className="text-xs font-bold text-slate-500 uppercase tracking-wider mb-1.5 flex justify-between">
                                                <span>Tickets / AP Rate</span>
                                                <span className="text-blue-400">Event Efficiency</span>
                                            </label>
                                            <div className="relative">
                                                <div className="absolute left-3 top-1/2 -translate-y-1/2 text-cyan-500"><Ticket size={20} /></div>
                                                <input 
                                                    type="text"
                                                    inputMode="decimal" 
                                                    name="ticketsPerAP" 
                                                    value={displayInputs.ticketsPerAP} 
                                                    onChange={handleInputChange} 
                                                    onBlur={handleInputBlur}
                                                    onKeyDown={handleKeyDown}
                                                    placeholder="e.g. 43/15"
                                                    className="w-full pl-10 pr-4 py-3 bg-slate-50 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-500/10 transition-all font-mono font-bold text-lg text-slate-700" 
                                                />
                                            </div>
                                        </div>
                                        <div className="group">
                                            <label className="text-xs font-bold text-slate-500 uppercase tracking-wider mb-1.5 flex justify-between">
                                                <span>Target Currency</span>
                                                <span className="text-blue-400">Goal</span>
                                            </label>
                                            <div className="relative">
                                                <div className="absolute left-3 top-1/2 -translate-y-1/2 text-rose-500"><Target size={20} /></div>
                                                <input 
                                                    type="text" 
                                                    inputMode="decimal"
                                                    name="targetTickets" 
                                                    value={displayInputs.targetTickets} 
                                                    onChange={handleInputChange} 
                                                    onBlur={handleInputBlur}
                                                    onKeyDown={handleKeyDown}
                                                    placeholder="e.g. 15000"
                                                    className="w-full pl-10 pr-4 py-3 bg-slate-50 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-500/10 transition-all font-mono font-bold text-lg text-slate-700" 
                                                />
                                            </div>
                                        </div>
                                        <div className="group">
                                            <label className="text-xs font-bold text-slate-500 uppercase tracking-wider mb-1.5 flex justify-between">
                                                <span>Event Duration</span>
                                                <span className="text-blue-400">Days Remaining</span>
                                            </label>
                                            <div className="relative">
                                                <div className="absolute left-3 top-1/2 -translate-y-1/2 text-emerald-500"><Calendar size={20} /></div>
                                                <input 
                                                    type="text" 
                                                    inputMode="decimal"
                                                    name="eventDuration" 
                                                    value={displayInputs.eventDuration} 
                                                    onChange={handleInputChange} 
                                                    onBlur={handleInputBlur}
                                                    onKeyDown={handleKeyDown}
                                                    placeholder="e.g. 14"
                                                    className="w-full pl-10 pr-4 py-3 bg-slate-50 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-500/10 transition-all font-mono font-bold text-lg text-slate-700" 
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-sky-50 border border-sky-100 rounded-xl p-4 flex gap-3 items-start relative overflow-hidden">
                                   <div className="bg-sky-400/20 p-2 rounded-full text-sky-600 z-10"><Info size={20} /></div>
                                   <div className="z-10">
                                     <h3 className="text-sm font-bold text-sky-800 mb-1">Arona's Note</h3>
                                     <p className="text-xs text-sky-700 leading-relaxed">
                                       You can calculate inputs directly! Try typing "43/15" for Efficiency or "360+50" for AP.
                                     </p>
                                   </div>
                                   <div className="absolute -right-6 -bottom-6 w-24 h-24 border-4 border-sky-200 rounded-full opacity-50"></div>
                                </div>
                            </div>

                            {/* Results */}
                            <div className="lg:col-span-7 space-y-6">
                                <div className={`rounded-2xl shadow-lg transition-all duration-300 overflow-hidden relative border-t-4 ${results.isPossible ? 'bg-white border-blue-500 shadow-blue-200/50' : 'bg-white border-rose-500 shadow-rose-200/50'}`}>
                                    <div className={`px-6 py-4 flex items-center justify-between ${results.isPossible ? 'bg-blue-50/50' : 'bg-rose-50/50'}`}>
                                        <h2 className="font-bold text-slate-700 flex items-center gap-2">TACTICAL ANALYSIS</h2>
                                        <div className={`flex items-center gap-2 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider ${results.isPossible ? 'bg-blue-100 text-blue-600' : 'bg-rose-100 text-rose-600'}`}>
                                            {results.isPossible ? <><CheckCircle size={14} /> Mission Possible</> : <><AlertTriangle size={14} /> AP Deficit</>}
                                        </div>
                                    </div>

                                    <div className="p-6 md:p-8">
                                        <div className="mb-8 text-center">
                                            <p className="text-sm font-bold text-slate-400 uppercase tracking-widest mb-2">Required Daily Allocation</p>
                                            <div className="flex items-center justify-center gap-2 text-5xl md:text-6xl font-black text-slate-800 tracking-tighter">
                                                <div className={`mt-2 ${results.isPossible ? 'text-amber-400' : 'text-slate-300'}`}><Zap size={40} /></div>
                                                <span>{formatNum(results.dailyEventAP)}</span>
                                            </div>
                                            <p className="text-slate-400 font-medium mt-1">AP per Day</p>
                                        </div>

                                        <div className="mb-8">
                                            <div className="flex justify-between text-xs font-bold text-slate-500 mb-2 uppercase">
                                                <span>AP Utilization</span>
                                                <span>{results.percentageUsed > 100 ? '>100%' : `${Math.round(results.percentageUsed)}%`}</span>
                                            </div>
                                            <div className="h-4 bg-slate-100 rounded-full overflow-hidden border border-slate-200">
                                                <div className={`h-full transition-all duration-700 ease-out relative ${results.isPossible ? 'bg-gradient-to-r from-blue-400 to-cyan-400' : 'bg-gradient-to-r from-rose-400 to-orange-400'}`} style={{ width: `${Math.min(results.percentageUsed, 100)}%` }}>
                                                    <div className="absolute inset-0 w-full h-full" style={{ backgroundImage: 'linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent)', backgroundSize: '1rem 1rem' }}></div>
                                                </div>
                                            </div>
                                            <div className="flex justify-between mt-2 text-xs font-medium text-slate-400"><span>0%</span><span>50%</span><span>100%</span></div>
                                        </div>

                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div className="bg-slate-50 p-4 rounded-xl border border-slate-100 flex items-center justify-between group hover:border-blue-200 transition-colors">
                                                <div><p className="text-xs font-bold text-slate-400 uppercase">Total AP Cost</p><p className="text-xl font-bold text-slate-700">{formatNum(results.totalAPRequired)}</p></div>
                                                <div className="w-10 h-10 rounded-full bg-white flex items-center justify-center text-slate-300 shadow-sm group-hover:text-blue-400 transition-colors"><CalculatorIcon size={20} /></div>
                                            </div>
                                            <div className={`p-4 rounded-xl border flex items-center justify-between group transition-colors ${results.isPossible ? 'bg-emerald-50/50 border-emerald-100 hover:border-emerald-300' : 'bg-rose-50/50 border-rose-100 hover:border-rose-300'}`}>
                                                <div>
                                                    <p className={`text-xs font-bold uppercase ${results.isPossible ? 'text-emerald-500' : 'text-rose-500'}`}>{results.isPossible ? 'Spare AP / Day' : 'AP Deficit / Day'}</p>
                                                    <p className={`text-xl font-bold ${results.isPossible ? 'text-emerald-700' : 'text-rose-700'}`}>{formatNum(Math.abs(results.dailySpareAP))}</p>
                                                </div>
                                                <div className={`w-10 h-10 rounded-full bg-white flex items-center justify-center shadow-sm ${results.isPossible ? 'text-emerald-400' : 'text-rose-400'}`}>{results.isPossible ? <CheckCircle size={20} /> : <AlertTriangle size={20} />}</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="h-2 bg-slate-100 flex"><div className="w-1/3 bg-blue-500 h-full"></div><div className="w-1/3 bg-cyan-400 h-full"></div><div className="w-1/3 bg-slate-200 h-full"></div></div>
                                </div>

                                <div className="bg-white rounded-xl shadow-sm border border-slate-100 p-5">
                                    <h3 className="text-sm font-bold text-slate-700 mb-3 flex items-center gap-2">
                                        <div className="w-2 h-2 bg-pink-500 rounded-sm rotate-45"></div>
                                        STRATEGIC RECOMMENDATION
                                    </h3>
                                    {results.isPossible ? (
                                        <div className="text-sm text-slate-600 leading-relaxed flex gap-4">
                                            <div className="shrink-0 w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center text-2xl">ðŸ˜Š</div>
                                            <div className="bg-slate-50 p-3 rounded-lg rounded-tl-none border border-slate-200 w-full relative">
                                                <p className="mb-2">Your current AP generation is sufficient! You have <strong className="text-emerald-600">{formatNum(results.dailySpareAP)} AP</strong> extra per day to spend on Hard Modes or other farming.</p>
                                                <p className="text-xs text-slate-400 font-medium">Sensei, good job on resource management!</p>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="text-sm text-slate-600 leading-relaxed flex gap-4">
                                            <div className="shrink-0 w-12 h-12 bg-rose-100 rounded-full flex items-center justify-center text-2xl">ðŸ˜–</div>
                                            <div className="bg-slate-50 p-3 rounded-lg rounded-tl-none border border-slate-200 w-full relative">
                                                <p className="mb-2">Warning! You are short by <strong className="text-rose-600">{formatNum(Math.abs(results.dailySpareAP))} AP</strong> daily.</p>
                                                <ul className="list-disc list-inside space-y-1 text-slate-500 text-xs">
                                                    <li>Consider using Pyroxene refreshes (30-60 AP/refresh).</li>
                                                    <li>Check if you have PvP Coin Shop energy drinks.</li>
                                                    <li>Verify Cafe rank upgrades.</li>
                                                </ul>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>

                        <footer className="mt-12 text-center text-xs text-slate-400 font-medium pb-8">
                            <div className="flex items-center justify-center gap-2 mb-2">
                                <div className="h-px w-12 bg-slate-200"></div>
                                <span>KIVOTOS AUTOMATED SYSTEMS</span>
                                <div className="h-px w-12 bg-slate-200"></div>
                            </div>
                            <p>Calculations are estimates. Actual drop rates may vary based on RNG.</p>
                        </footer>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BlueArchiveCalculator />);
    </script>
</body>
</html>